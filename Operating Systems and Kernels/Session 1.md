# Building and Booting Linus‚Äôs kernel

### üõ†Ô∏è Kernel Build Toolchain ‚Äì Key Libraries

### `flex`

- A **lexical analyzer generator**.
- Breaks text into tokens (used to process configuration files or code).
- Required by kernel when building parsers.

### `bison`

- A **parser generator**.
- Uses grammar rules to understand structure of code or config.
- Often used with `flex` to generate parsing tools for the kernel.

### `libelf-dev`

- A library to **read and work with ELF (Executable and Linkable Format)** files.
- Used during kernel build to inspect `.o`, `.ko`, and ELF binaries.
- Lets tools check sections, symbols, and metadata in compiled files.
- Essential for features like BPF, kallsyms, and module linking.

  

### Kernel Configuration Files ‚Äì Quick Notes

### `.config`

- A plain text file containing **your selected kernel build options**.
- Generated by tools like `make defconfig`, `make menuconfig`, or `make oldconfig`.
- Format: `CONFIG_OPTION=value` (e.g., `CONFIG_USB=y`)
- Used by `make` to determine what to compile.

---

### `Kconfig`

- A **declarative configuration script** used to define:
    - What options exist
    - Their types (bool, tristate, etc.)
    - Dependencies between options
    - Descriptions/help text
- Found across the kernel source tree (`drivers/Kconfig`, `fs/Kconfig`, etc.)
- Parsed by tools like `menuconfig` to build the UI or prompts.

  

### Grub

GRUB (GNU GRand Unified Bootloader) is the **bootloader** your system uses to start the operating system.

### What It Does:

1. **Runs right after BIOS/UEFI**, before Linux starts.
2. **Shows a menu** with available kernels or OSes.
3. Loads the selected kernel and passes control to it.

### Why You Care (for Kernel Dev):

- When you build and install a new kernel, GRUB adds it as a **boot option**.
- You can choose between your custom kernel and the stable one.
- If your custom kernel fails to boot, GRUB lets you fall back.

  

### **1. Why Compile a Kernel?**

- The Linux kernel is **not just source code**; it must be compiled into a binary that the system can execute at boot.
- Pre-compiled kernels from distributions are **general-purpose**, including support for a wide range of hardware and use cases.
- Compiling a kernel allows for **customization, optimization, and control** over system performance and security.

  

### **2. What is** `**make oldconfig**`**?**

We are copying the current working kernel‚Äôs config file to our linux source folder. This just edits this .config file to further accomodate any new changes in the kernel it is being used for.

- A **kernel build target** that updates your configuration file (`.config`).
- Ensures compatibility with a newer kernel version by checking for **new options**.
- Prompts you to accept defaults or modify settings for newly introduced features.

  

### **3. Purpose of make modules**

- Compiles **loadable kernel modules** (`.ko` files) separately from the kernel image.

### **Command Breakdown**

- `make modules` ‚Üí Builds all kernel modules.
- `j4` ‚Üí Uses 4 threads for faster compilation.

### **Why?**

- Kernel modules allow **dynamic loading/unloading** of features (e.g., drivers, filesystems).
- Only needed if the kernel configuration (`.config`) includes modular components.

### **When to Use?**

- After compiling the kernel (`make bzImage`).
- Before installing modules (`make modules_install`).

